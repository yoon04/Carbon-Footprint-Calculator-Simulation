<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detailed Low-Poly Tree - Three.js</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #111; font-family: sans-serif; }
        #instructions {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 5px;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="instructions">
        <strong>Multi-Branch Tree</strong><br>
        Rotate: Left Click + Drag<br>
        Zoom: Mouse Wheel
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // --- 1. SCENE & RENDERER ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x1a1a1a);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        // --- 2. CAMERA ---
        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(12, 12, 18);

        // --- 3. LIGHTING ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
        scene.add(ambientLight);

        const sunLight = new THREE.DirectionalLight(0xffffff, 1.5);
        sunLight.position.set(10, 20, 10);
        scene.add(sunLight);

        // --- 4. THE COMPLEX TREE ---
        const tree = new THREE.Group();

        // Materials
        const trunkMat = new THREE.MeshStandardMaterial({ color: 0x5d4037, flatShading: true });
        const leafMat = new THREE.MeshStandardMaterial({ color: 0x388e3c, flatShading: true });

        // Main Trunk
        const mainTrunkGeo = new THREE.CylinderGeometry(0.5, 0.8, 6, 8);
        const mainTrunk = new THREE.Mesh(mainTrunkGeo, trunkMat);
        mainTrunk.position.y = 3;
        tree.add(mainTrunk);

        // Top-most foliage "Crown"
        const crown = new THREE.Mesh(new THREE.IcosahedronGeometry(2, 0), leafMat);
        crown.position.set(0, 6.5, 0);
        tree.add(crown);

        // Function to add a branch with foliage
        function addBranch(height, angleY, tiltZ, length, leafSize) {
            const branchGroup = new THREE.Group();
            
            // Branch wood
            const bGeo = new THREE.CylinderGeometry(0.15, 0.3, length, 6);
            const bMesh = new THREE.Mesh(bGeo, trunkMat);
            
            // Position the wood so the base is at the trunk
            bMesh.position.y = length / 2;
            branchGroup.add(bMesh);

            // Add foliage puff at the end of this branch
            const leaf = new THREE.Mesh(new THREE.IcosahedronGeometry(leafSize, 0), leafMat);
            leaf.position.y = length;
            branchGroup.add(leaf);

            // Pivot logic: move the group to the height, then rotate
            branchGroup.position.y = height;
            branchGroup.rotation.z = tiltZ;
            
            // Create a wrapper to handle the Y rotation around the trunk
            const pivot = new THREE.Group();
            pivot.rotation.y = angleY;
            pivot.add(branchGroup);
            
            tree.add(pivot);
        }

        // Adding 8 randomized branches
        const branchData = [
            { h: 2.5, ay: 0, tz: 1.1, len: 3, s: 1.2 },
            { h: 3.0, ay: Math.PI * 0.5, tz: 0.9, len: 2.5, s: 1.0 },
            { h: 3.5, ay: Math.PI, tz: 1.2, len: 3.2, s: 1.3 },
            { h: 4.0, ay: Math.PI * 1.5, tz: 0.8, len: 2, s: 0.9 },
            { h: 4.5, ay: 0.7, tz: 0.7, len: 2.8, s: 1.1 },
            { h: 5.0, ay: 2.5, tz: 0.6, len: 2.2, s: 0.8 },
            { h: 5.2, ay: 4.2, tz: 1.0, len: 2.5, s: 1.0 },
            { h: 2.0, ay: 5.5, tz: 1.3, len: 3.5, s: 1.4 },
        ];

        branchData.forEach(data => {
            addBranch(data.h, data.ay, data.tz, data.len, data.s);
        });

        scene.add(tree);

        // --- 5. FLOOR ---
        const grid = new THREE.GridHelper(40, 40, 0x444444, 0x222222);
        scene.add(grid);

        // --- 6. CONTROLS ---
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        // --- 7. ANIMATION ---
        function animate() {
            requestAnimationFrame(animate);
            // No auto-rotation here as requested!
            controls.update();
            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
    </script>
</body>
</html>